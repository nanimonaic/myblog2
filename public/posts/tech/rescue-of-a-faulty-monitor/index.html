<!doctype html><html lang=zh dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>Rescue of a Faulty Monitor | nanimonai's Blog</title>
<meta name=keywords content><meta name=description content="低品質のブログ"><meta name=author content="nanimonai"><link rel=canonical href=http://localhost:1313/posts/tech/rescue-of-a-faulty-monitor/><link crossorigin=anonymous href=/assets/css/stylesheet.0aa869c09b4b0cc7fb74b05914fa294a7d4bb5e5bcc7ac5a201534ce91321b93.css integrity="sha256-CqhpwJtLDMf7dLBZFPopSn1LteW8x6xaIBU0zpEyG5M=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://img.nanimonai.org/headimg.jpg><link rel=icon type=image/png sizes=16x16 href=https://img.nanimonai.org/headimg.jpg><link rel=icon type=image/png sizes=32x32 href=https://img.nanimonai.org/headimg.jpg><link rel=apple-touch-icon href=https://img.nanimonai.org/headimg.jpg><link rel=mask-icon href=https://img.nanimonai.org/headimg.jpg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=http://localhost:1313/posts/tech/rescue-of-a-faulty-monitor/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script>>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Neuromancer (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Neuromancer</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=http://localhost:1313/posts title=文章><span>文章</span></a></li><li><a href=http://localhost:1313/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=http://localhost:1313/link title=友链><span>友链</span></a></li><li><a href=http://localhost:1313/about/ title=关于><span>关于</span></a></li><li><a href=http://localhost:1313/archives/ title=归档><span>归档</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>主页</a>&nbsp;»&nbsp;<a href=http://localhost:1313/tech/>技术</a></div><h1 class=post-title>Rescue of a Faulty Monitor</h1><div class=post-description>低品質のブログ</div></header><div class=post-content><h1 id=失灵显示器拯救记><strong>失灵显示器拯救记</strong><a hidden class=anchor aria-hidden=true href=#失灵显示器拯救记>#</a></h1><p>​本人在10月份换成了MATX，电脑也从N系笔记本来到了AMD的6750GRE</p><p>入手一2.5k16寸显示器。本来想自制的，后面听朋友说非常麻烦且容易踩坑，DIY花销不一定比自己小，于是直接购入别人已经做好的所谓A-屏。在我这台的情况是所谓A-屏就是有一个0.1mm不到的色块不显示，个人认为还能接受并且价格也还挺美丽</p><p>​然后问题就来了，小作坊用料就是怪，即这个显示器跑不到预想的分辨率和刷新率。在Windows系统上我的解决办法是使用AMD Software生成一份配置文件，其中他会写一个对于刷新率的感叹号但是你不用去管它。来到Arch我就有些头疼了，他直接给我画面干撕裂了，然后设置界面是经典的“仅支持 640x350”，遂尝试</p><h2 id=失败的尝试>失败的尝试：<a hidden class=anchor aria-hidden=true href=#失败的尝试>#</a></h2><p>GPT师傅建议我去使用cvt创建自定义模式</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-1 data-lang=1><span class=line><span class=cl>cvt 2560 1440 240
</span></span><span class=line><span class=cl>xrandr --newmode &#34;2560x1600_240.00&#34; 808.75 2560 2792 3072 3584 1440 1443 1448 1493 -hsync +vsync
</span></span><span class=line><span class=cl>xrandr --addmode DP-1 &#34;2560x1600_240.00&#34;
</span></span><span class=line><span class=cl>xrandr --output DP-1 --mode &#34;2560x1600_240.00&#34;
</span></span></code></pre></div><p>类似这样，一个 RRSetCrtcConfig 错误，表明设置的显示模式参数超出了范围</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-1 data-lang=1><span class=line><span class=cl>X Error of failed request:  BadValue (integer parameter out of range for operation)Major opcode of failed request:  140 (RANDR)Minor opcode of failed request:  21 (RRSetCrtcConfig)Value in failed request:  0x78Serial number of failed request:  28
</span></span><span class=line><span class=cl>Current serial number in output stream:  28
</span></span></code></pre></div><p>看下日志的 EDID (Extended display identification data) 怎么说</p><pre tabindex=0><code class=language-sudo data-lang=sudo>&gt; sudo get-edid | parse-edid
This is read-edid version 3.0.2. Prepare for some fun.
Attempting to use i2c interface
Problem requesting slave address: Device or resource busy
No EDID on bus 1
No EDID on bus 2
No EDID on bus 3
No EDID on bus 4
No EDID on bus 5
No EDID on bus 6
No EDID on bus 7
No EDID on bus 8
No EDID on bus 10
2 potential busses found: 9 11
Will scan through until the first EDID is found.
Pass a bus number as an option to this program to go only for that one.
256-byte EDID successfully retrieved from i2c bus 9
Looks like i2c was successful. Have a good day.
You seem to have too many extension blocks. Will not continue to parse
Something strange happened. Please contact the author,
Matthew Kern at &lt;pyrophobicman@gmail.com&gt;
</code></pre><p>问题：EDID 读取出现异常，显示有太多的扩展块；显示模式创建失败，可能是因为像素时钟超出了硬件支持范围</p><p>后面使用gtf创建不同刷新率和分辨率的样式，都不行</p><p>值得一提的是，Linux读取和显示EDID信息是使用read-edid这类或者X.Org Server这样去读取的，而在Windows中则是PowerStrip。而EDID和DDC又是老朋友，通过DDC传输（传奇I2C）</p><h2 id=成功的尝试>成功的尝试：<a hidden class=anchor aria-hidden=true href=#成功的尝试>#</a></h2><p>先创建一个新的 xorg 配置文件，专门处理 EDID 问题</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-1 data-lang=1><span class=line><span class=cl>sudo nano /etc/X11/xorg.conf.d/20-amdgpu.conf
</span></span></code></pre></div><p>里面添加：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-1 data-lang=1><span class=line><span class=cl>Section &#34;Device&#34;
</span></span><span class=line><span class=cl>    Identifier &#34;AMD&#34;
</span></span><span class=line><span class=cl>    Driver &#34;amdgpu&#34;
</span></span><span class=line><span class=cl>    Option &#34;TearFree&#34; &#34;true&#34;
</span></span><span class=line><span class=cl>    Option &#34;DRI&#34; &#34;3&#34;
</span></span><span class=line><span class=cl>    Option &#34;IgnoreEDID&#34; &#34;false&#34;
</span></span><span class=line><span class=cl>    Option &#34;CustomEDID&#34; &#34;DP-1:/etc/X11/edid.bin&#34;
</span></span><span class=line><span class=cl>    Option &#34;ModeValidation&#34; &#34;AllowNonEdidModes&#34;
</span></span><span class=line><span class=cl>EndSection
</span></span></code></pre></div><p>然后去修改内核参数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-1 data-lang=1><span class=line><span class=cl>sudo nano /etc/default/grub
</span></span></code></pre></div><p>在 GRUB_CMDLINE_LINUX_DEFAULT 中加入：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-1 data-lang=1><span class=line><span class=cl>video=DP-1:2560x1600@200 amdgpu.dc=1 amdgpu.dpm=1 amdgpu.modeset=1  
</span></span></code></pre></div><p>这边我看了一眼我的配置文件这行还写着nvidia_drm.modeset=1，顺手给删了（相信暂时应该不会换回N系显卡）</p><p>修改后输入如下代码并重启</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-1 data-lang=1><span class=line><span class=cl>sudo grub-mkconfig -o /boot/grub/grub.cfg
</span></span></code></pre></div><p>Reboot后看一眼</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-1 data-lang=1><span class=line><span class=cl>&gt; xrandr --props
</span></span><span class=line><span class=cl>DP-1 connected 2560x1600+0+0 (normal left inverted right x axis y axis) 0mm x 0mm
</span></span><span class=line><span class=cl>        RANDR Emulation: 1 
</span></span><span class=line><span class=cl>        non-desktop: 0 
</span></span><span class=line><span class=cl>                supported: 0, 1
</span></span><span class=line><span class=cl>   2560x1600    199.86*+
</span></span><span class=line><span class=cl>    ...
</span></span></code></pre></div><p>说明解决了</p></div><footer class=post-footer><ul class=post-tags></ul></footer><script src=https://giscus.app/client.js data-repo=nanimonaic/docx data-repo-id=R_kgDOKiAoMQ data-category-id=DIC_kwDOKiAoMc4CaPcT data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>nanimonai's Blog</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>