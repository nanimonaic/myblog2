<!doctype html><html lang=zh dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>Research on the principle of automatic punch-in | nanimonai's Blog</title><meta name=keywords content><meta name=description content="应用"><meta name=author content="nanimonai"><link rel=canonical href=http://localhost:1313/posts/tech/research-on-the-principle-of-automatic-punch-in/><link crossorigin=anonymous href=/assets/css/stylesheet.8dc51781c85c4e1478cc2c27791f96bc57032d0efa65fb0911e90cc302c02dbb.css integrity="sha256-jcUXgchcThR4zCwneR+WvFcDLQ76ZfsJEekMwwLALbs=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://img.nanimonai.org/headimg.jpg><link rel=icon type=image/png sizes=16x16 href=https://img.nanimonai.org/headimg.jpg><link rel=icon type=image/png sizes=32x32 href=https://img.nanimonai.org/headimg.jpg><link rel=apple-touch-icon href=https://img.nanimonai.org/headimg.jpg><link rel=mask-icon href=https://img.nanimonai.org/headimg.jpg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=http://localhost:1313/posts/tech/research-on-the-principle-of-automatic-punch-in/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script>>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Neuromancer (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Neuromancer</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=http://localhost:1313/posts title=文章><span>文章</span></a></li><li><a href=http://localhost:1313/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=http://localhost:1313/link title=友链><span>友链</span></a></li><li><a href=http://localhost:1313/about/ title=关于><span>关于</span></a></li><li><a href=http://localhost:1313/archives/ title=归档><span>归档</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>主页</a>&nbsp;»&nbsp;<a href=http://localhost:1313/tech/>技术</a></div><h1 class=post-title>Research on the principle of automatic punch-in</h1><div class=post-description>应用</div></header><div class=post-content><h1 id=这是什么>这是什么<a hidden class=anchor aria-hidden=true href=#这是什么>#</a></h1><p>近日，打卡更新方式，由之前转移到了某一新平台上。求知欲驱使进行研究。写的不周，还请包含，同时我要非常感谢lockey中的一位热心朋友不厌其烦地为我指点迷津。</p><h1 id=如何实现>如何实现<a hidden class=anchor aria-hidden=true href=#如何实现>#</a></h1><h2 id=第一步>第一步<a hidden class=anchor aria-hidden=true href=#第一步>#</a></h2><p>首先是获取签到的数据。</p><p>先去官网下载.apk文件，而众所周知，.apk是一种压缩文件，所以直接解压出来，查找一下发现是rsa，然后思考如何拿到公钥。
<img loading=lazy src=https://img.nanimonai.org/bunan.png></p><p>继续find寻找.pem，找到一个证书（本人搞到这里有点绷不住了，真的难绷）</p><p><img loading=lazy src=https://img.nanimonai.org/pem.png></p><p>写如下代码以还原出公钥：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>OpenSSL.crypto</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cert_text</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>-----BEGIN CERTIFICATE-----
</span></span></span><span class=line><span class=cl><span class=s2>MIIFizCCA3OgAwIBAgIDAJY4MA0GCSqGSIb3DQEBCwUAMIGAMQswCQYDVQQGEwJD
</span></span></span><span class=line><span class=cl><span class=s2>TjEQMA4GA1UECAwHQmVpamluZzEMMAoGA1UECgwDTVNBMREwDwYDVQQLDAhPQUlE
</span></span></span><span class=line><span class=cl><span class=s2>X1NESzEeMBwGA1UEAwwVY29tLmJ1bi5taWl0bWRpZC5zaWduMR4wHAYJKoZIhvcN
</span></span></span><span class=line><span class=cl><span class=s2>AQkBFg9tc2FAY2FpY3QuYWMuY24wHhcNMjQwMTA3MTQ0ODU1WhcNMjUwMTA3MTQ0
</span></span></span><span class=line><span class=cl><span class=s2>ODU1WjB9MQswCQYDVQQGEwJDTjEQMA4GA1UECAwHQmVpamluZzEQMA4GA1UEBwwH
</span></span></span><span class=line><span class=cl><span class=s2>QmVpamluZzEQMA4GA1UECgwHd2phY2tlcjEWMBQGA1UEAwwNY29tLnlpYmFuLmFw
</span></span></span><span class=line><span class=cl><span class=s2>cDEgMB4GCSqGSIb3DQEJARYRd2FuZ2ppZTJAeWliYW4uY24wggIiMA0GCSqGSIb3
</span></span></span><span class=line><span class=cl><span class=s2>DQEBAQUAA4ICDwAwggIKAoICAQCyGC9T3GW4BSsvnVNqb8+HlnjJAQvTPd7H13m1
</span></span></span><span class=line><span class=cl><span class=s2>f945uUsUYYMaaZuICYjb4qefZUyQgyxBUTYfBOTpE7ccdcNoZgCp05RTng30zvkc
</span></span></span><span class=line><span class=cl><span class=s2>4pjawJIkNeIC2NGlN7RquO4Ka/06LSuq5N+bfL78E0MwZAinoxSswf/yNY5R1LJ2
</span></span></span><span class=line><span class=cl><span class=s2>b3I7BnW7rVSb7KbB0Q4z5KmuJ04hPVl7BtSdfVnvnRVTBDRm/cMgyupEl+CCGW8H
</span></span></span><span class=line><span class=cl><span class=s2>UejzPHdHeHRK1rx7fuwQI+5jgMmDYRNXZD4AmJ0vClurQR5avN2xOuxB8HbtB+lQ
</span></span></span><span class=line><span class=cl><span class=s2>itsNnQCvYY1Xp4s7FtfmT6JzDNQ//vRgXxYrOaVFfoY/ugrO+SfZtqej+mdKR3Kg
</span></span></span><span class=line><span class=cl><span class=s2>OaAA75t8zcJfM6WGrbPJl3xHc2bhD4kGwRkTAcHJ7WQOIrWz85CPCfIoYh8nZlBl
</span></span></span><span class=line><span class=cl><span class=s2>sCNamJJh6Pl2nAtmnfMtDuYZJo/2QK6J/KFtywsYIekU6fiRsJaaunBf5sD9Ixbv
</span></span></span><span class=line><span class=cl><span class=s2>JcRRB+HRCsySKYEg8z7Xlh90fHimfUgT0Gt44/o+nzPh7Cq9Ay6dWtMxYFx78Z1e
</span></span></span><span class=line><span class=cl><span class=s2>papOJdUNpZWIET8wQHriJmbJ18TlidGRAW85kW2ka2cr4u6Ed68JQa+nN+kbS0dD
</span></span></span><span class=line><span class=cl><span class=s2>euvOBGOsiqqCy5aeA0oz88HRWWIga02PLTZbEs4PdYrNzHWCISjnk34KpwwxYJUn
</span></span></span><span class=line><span class=cl><span class=s2>6Zpy1wIDAQABoxAwDjAMBgNVHRMBAf8EAjAAMA0GCSqGSIb3DQEBCwUAA4ICAQAk
</span></span></span><span class=line><span class=cl><span class=s2>o30meLI9Un/7KoUekSMhterJ6K11cHKAa+WQqqzp8If+gIhjsyYk7Wf1fgStvoNu
</span></span></span><span class=line><span class=cl><span class=s2>jILWSAfe2C2k74QrlVsUFXue2Ekc+eyDbUhwOi4rVju68/eu4HSpdIUbFQ7ZpivC
</span></span></span><span class=line><span class=cl><span class=s2>adjw7qfN90sp6S+O/dDQ9SzUPBpjMQQ6ZvSTFv7TtZ1cjzOpcfogrDGyOe+mE5Rv
</span></span></span><span class=line><span class=cl><span class=s2>xT3IaWFBcY2fe8lh+/7mJ27A5XgCka1LTZ2OFwI4d1gPWRhwi7R0p4rGhtmk2JJG
</span></span></span><span class=line><span class=cl><span class=s2>viz1rPn8pBBeR5zcwHFuDAbL/1C9d6rZ5lajycrdPZzbcuFAzx7NPafiMsyMYwBK
</span></span></span><span class=line><span class=cl><span class=s2>9oQDIjS5UmfMt+lMFk37yCesFqxq/DOIPm1Hz3N1t5RpcZuwIkCzXYhtOkCbu9SZ
</span></span></span><span class=line><span class=cl><span class=s2>xKqxztpcA5ySf3DWH4TIxKGXxIlC5pr2F4HsmKDIAO/1O6HXI0Bo+s/3KsDS/IMV
</span></span></span><span class=line><span class=cl><span class=s2>nlqKu1WUKUZJebjN/CL61ChfHjkmogslgTkQpJnGsWsix3v0nBFjpbOm/oXYYMJy
</span></span></span><span class=line><span class=cl><span class=s2>p+aMzppKaLx3mniXW/kimteNKu8EdeE7x/QeEIk5IUotfRPAeydVk9yqf+c4ClS9
</span></span></span><span class=line><span class=cl><span class=s2>YwVFAqIDzbC3nLBBXb36WNOoG+MFwWkjKoPhtIoLysTN1gNuFYUlJ1JptoP0Pe0I
</span></span></span><span class=line><span class=cl><span class=s2>k5FWnRRk1vKUktYUfMJE4PQg4sWxZhGkKrGU5zVLsg==
</span></span></span><span class=line><span class=cl><span class=s2>-----END CERTIFICATE-----
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cert</span><span class=o>=</span><span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>load_certificate</span><span class=p>(</span><span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>FILETYPE_PEM</span><span class=p>,</span> <span class=n>cert_text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>public_key</span><span class=o>=</span><span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>dump_publickey</span><span class=p>(</span><span class=n>OpenSSL</span><span class=o>.</span><span class=n>crypto</span><span class=o>.</span><span class=n>FILETYPE_PEM</span><span class=p>,</span> <span class=n>cert</span><span class=o>.</span><span class=n>get_pubkey</span><span class=p>())</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>public_key</span><span class=p>)</span>
</span></span></code></pre></div><p>得出公钥就够用了：</p><p><img loading=lazy src=https://img.nanimonai.org/rsa.png></p><h2 id=第二步>第二步<a hidden class=anchor aria-hidden=true href=#第二步>#</a></h2><p>获取cookie，参考github可得：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>auth</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>COOKIES</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=n>CSRF</span> <span class=o>=</span> <span class=s2>&#34;00000000000000000000000000000000&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>HEADERS</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Origin&#34;</span><span class=p>:</span> <span class=s2>&#34;m.yiban.cn&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;origin&#34;</span><span class=p>:</span><span class=s2>&#34;api.uyiban.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;origin&#34;</span><span class=p>:</span><span class=s2>&#34;https://c.uyiban.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;authority&#34;</span><span class=p>:</span> <span class=s2>&#34;api.uyiban.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;AppVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;5.0.17&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;x-requested-with&#34;</span><span class=p>:</span> <span class=s2>&#34;com.yiban.app&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;user-agent&#34;</span><span class=p>:</span><span class=s2>&#34;Mozilla/5.0 (Linux; Android 12; XIAOMI Build/SKQ1.211006.001; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/112.0.5615.48 Mobile Safari/537.36;webank/h5face;webank/1.0 yiban_android/5.0.17&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>iapp</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://f.yiban.cn/iapp/index?act=iapp7463&#34;</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>HEADERS</span><span class=p>,</span> <span class=n>allow_redirects</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>cookies</span><span class=o>=</span><span class=n>COOKIES</span><span class=p>)</span> <span class=c1># 利用 loginToken 访问获取 verifyRequest跳转数据</span>
</span></span><span class=line><span class=cl>    <span class=c1># 此处cookie带有 &#34;loginToken&#34; = “cdd6d4432743414c9e1faf3e792*****”</span>
</span></span><span class=line><span class=cl>    <span class=n>act</span> <span class=o>=</span> <span class=n>iapp</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s2>&#34;Location&#34;</span><span class=p>]</span> <span class=c1># 返回302跳转目标</span>
</span></span><span class=line><span class=cl>    <span class=n>verifyRequest</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=sa>r</span><span class=s2>&#34;verify_request=(.*?)&amp;&#34;</span><span class=p>,</span> <span class=n>act</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span> <span class=c1># 正则取302跳转目标，得到 verify_request 数据</span>
</span></span><span class=line><span class=cl>    <span class=n>json</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;https://api.uyiban.com/base/c/auth/yiban?verifyRequest=&#34;</span> <span class=o>+</span> <span class=n>verifyRequest</span> <span class=o>+</span> <span class=s2>&#34;&amp;CSRF=&#34;</span> <span class=o>+</span> <span class=n>CSRF</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>HEADERS</span><span class=p>,</span> <span class=n>allow_redirects</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>cookies</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;csrf_token&#39;</span><span class=p>:</span> <span class=n>CSRF</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=n>cookies</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>utils</span><span class=o>.</span><span class=n>dict_from_cookiejar</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>cookies</span><span class=p>)</span> <span class=c1># 获取cookie</span>
</span></span><span class=line><span class=cl>    <span class=n>Attendancecookies</span> <span class=o>=</span> <span class=n>cookies</span> <span class=c1># 签到cookies赋值self.Attendancecookies</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Location:&#39;</span><span class=p>,</span><span class=n>act</span><span class=p>,</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;cookies:&#39;</span><span class=p>,</span><span class=n>Attendancecookies</span><span class=p>,</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>###打印数据：</span>
</span></span><span class=line><span class=cl>    <span class=n>Location</span><span class=p>:</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>c</span><span class=o>.</span><span class=n>uyiban</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=c1>#/?verify_request=c9e814****53de92ccc&#39;, &#39;cpi&#39;: &#39;eyJD******%3D%3D&#39;, &#39;is_certified&#39;: &#39;1&#39;}    </span>
</span></span><span class=line><span class=cl>    <span class=n>cookies</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;PHPSESSID&#39;</span><span class=p>:</span> <span class=s1>&#39;fa1a28bc38cc**c4b1e87a8ce51f****&#39;</span><span class=p>,</span> <span class=s1>&#39;cpi&#39;</span><span class=p>:</span> <span class=s1>&#39;eyJDaG**%3D%3D&#39;</span><span class=p>,</span> <span class=s1>&#39;is_certified&#39;</span><span class=p>:</span> <span class=s1>&#39;1&#39;</span><span class=p>}</span>
</span></span></code></pre></div><p>All right. 现在只需要PHPSESSID.</p><h2 id=第三步>第三步<a hidden class=anchor aria-hidden=true href=#第三步>#</a></h2><p>进行ADB调试，其中挺复杂的。我未来也要尝试一下有没有更加简单的调试方法。首先你PC得有Chrome，Firefox就不行。我Linux上面用的是Chromium。第一次尝试的时候移动端使用的是旧版本的Kiwi Browser，导致 chrome://inspect/#devices 这个界面没有inspect fallback选项。更新就行了。</p><p>在kiwi上找到Network Conditions，把用户代理叉掉并自定义写上MicroMessenger。</p><p><img loading=lazy src=https://img.nanimonai.org/network.png></p><p>这个其实可以直接在控制台输入命令获取（忘记截图了，可以自己去试一下）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-1 data-lang=1><span class=line><span class=cl>console.log(&#34;User-Agent:&#34;, navigator.userAgent);
</span></span></code></pre></div><p>直接从中间几个开始分析（其实是依葫芦画瓢），能够成功找到https://api.uyiban.com/nightAttendance/student/index/signIn?CSRF=&mldr;</p><p>以及https://api.uyiban.com/nightAttendance/student/index/signPosition?CSRF=&mldr;</p><p>这样就可以进行测试，API 是 RESTful 标准。从登录开始追踪，使用curl去调试。</p><p><img loading=lazy src=https://img.nanimonai.org/gongzuotai.png>
<img loading=lazy src=https://img.nanimonai.org/yes.png></p><p>错误的都是{&lsquo;code&rsquo;: 500, &lsquo;msg&rsquo;: &lsquo;非法签到&rsquo;, &lsquo;data&rsquo;: None} 0.0</p><p>签到成功会返回{&lsquo;code&rsquo;: 0, &lsquo;msg&rsquo;: &lsquo;&rsquo;, &lsquo;data&rsquo;: True}</p><h2 id=第四步-前人的智慧>第四步 前人的智慧！<a hidden class=anchor aria-hidden=true href=#第四步-前人的智慧>#</a></h2><p>脚本是大爱无私宽仁的Mike修改的，最初版是来自<a href=https://wcyuns.cn/archives/%E6%98%93%E7%8F%AD%E6%99%9A%E7%AD%BE%E8%84%9A%E6%9C%AC>this</a>思路也是借鉴于此，上面也算是重走一遍。真所谓巧夺天工，令人敬佩！</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pickle</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>jsonpath</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>urllib</span> <span class=kn>import</span> <span class=n>parse</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>msvcrt</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>PKCS1_v1_5</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Crypto.PublicKey</span> <span class=kn>import</span> <span class=n>RSA</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>ModuleNotFoundError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;缺少pycryptodome依赖！程序将尝试安装依赖！&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s2>&#34;pip3 install pycryptodome -i https://pypi.tuna.tsinghua.edu.cn/simple&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=n>execl</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>executable</span><span class=p>,</span> <span class=s1>&#39;python3&#39;</span><span class=p>,</span> <span class=vm>__file__</span><span class=p>,</span> <span class=o>*</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encryptPassword</span><span class=p>(</span><span class=n>pwd</span><span class=p>):</span> <span class=c1># 登录密码加密</span>
</span></span><span class=line><span class=cl>    <span class=c1># 密码加密</span>
</span></span><span class=line><span class=cl>    <span class=n>PUBLIC_KEY</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;-----BEGIN PUBLIC KEY-----
</span></span></span><span class=line><span class=cl><span class=s1>MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAzq0rgsM++ZxLRGHpdfre
</span></span></span><span class=line><span class=cl><span class=s1>Hu6UXhdlUS5P2WOxRG14qU8/iWSb/CkOqgOl8AGcOhlthkvolCdpUvVcVsVUxBv0
</span></span></span><span class=line><span class=cl><span class=s1>YRN0Jb64zPrn5aLVwQT4RJn5tXvoqLdHIXis7pljXAMDPVZOVlWJkDMk8YU6HDaA
</span></span></span><span class=line><span class=cl><span class=s1>MqsD6l5p9lg2LMP4OhMgaPX+CkO370LB5vRjJTHp03n+IqfxXoC7DEd+kxRIEM2C
</span></span></span><span class=line><span class=cl><span class=s1>EDgUSYDJBDgwBvGALZmvB/a1b0im9t1P/EmnuE7uN9NRFoWyVpOiEwo/Ti7rmJGf
</span></span></span><span class=line><span class=cl><span class=s1>qNT3vvtfWo4nXsm1rYQXsPayoKDSRaba3gFY/1SYWLAuSO2q2da5ZCcsAk5RKy0V
</span></span></span><span class=line><span class=cl><span class=s1>c1hUg8n6y0YLAvuzoXY5VyNMXkhH5Zc5Kg64b5RxILeZpZG0MV7GFY3sw//k7SNg
</span></span></span><span class=line><span class=cl><span class=s1>darKT8A0Iv3l3lfguX3HNi6dkf97kS/EiA0tbkIB/JNjv13mq8HL7LijRt2hkKqP
</span></span></span><span class=line><span class=cl><span class=s1>PhQW88xC/exZilU5pAavoZOPuZIOTUHqtpRq4ZeKl+wDf+e5lPYFDpihWGjplGpa
</span></span></span><span class=line><span class=cl><span class=s1>4BOSmGeo/SyVFPji9QF4Pk0DRJF/NjwJoAC60xHAVt5Z4gQSOOOjNZDCswA0ry2L
</span></span></span><span class=line><span class=cl><span class=s1>e8m5cv5vPGY75uVrGqALQ6Xm961PPc5cJ1q7tmEZMj+z5HE7tgAdhiPI6acKgrAv
</span></span></span><span class=line><span class=cl><span class=s1>+1k4N0OVqKamMS+PVpD05hUCAwEAAQ==
</span></span></span><span class=line><span class=cl><span class=s1>-----END PUBLIC KEY-----&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>PKCS1_v1_5</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>RSA</span><span class=o>.</span><span class=n>importKey</span><span class=p>(</span><span class=n>PUBLIC_KEY</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher_text</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=nb>bytes</span><span class=p>(</span><span class=n>pwd</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf8&#34;</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher_text</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>####################################################################################################################################################################################################</span>
</span></span><span class=line><span class=cl><span class=c1>####################################################################################################################################################################################################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>yiban</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>COOKIES</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>mobile</span><span class=p>,</span> <span class=n>password</span><span class=p>):</span> <span class=c1># 全局变量</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mobile</span> <span class=o>=</span> <span class=n>mobile</span> <span class=c1># 登录手机号</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>password</span> <span class=o>=</span> <span class=n>password</span> <span class=c1># 登录密码</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>session</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>HEADERS</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Origin&#34;</span><span class=p>:</span> <span class=s2>&#34;m.yiban.cn&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;origin&#34;</span><span class=p>:</span><span class=s2>&#34;api.uyiban.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;origin&#34;</span><span class=p>:</span><span class=s2>&#34;https://c.uyiban.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;authority&#34;</span><span class=p>:</span> <span class=s2>&#34;api.uyiban.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;AppVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;5.1.2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;x-requested-with&#34;</span><span class=p>:</span> <span class=s2>&#34;com.yiban.app&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;user-agent&#34;</span><span class=p>:</span><span class=s2>&#34;Mozilla/5.0 (Linux; Android 12; Redmi K30 Pro Build/SKQ1.211006.001; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/112.0.5615.48 Mobile Safari/537.36;webank/h5face;webank/1.0 yiban_android/5.0.17&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>Attendancecookies</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>CSRF</span> <span class=o>=</span> <span class=s2>&#34;00000000000000000000000000000000&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>login</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span> <span class=c1># 登录</span>
</span></span><span class=line><span class=cl>        <span class=n>params</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;mobile&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>mobile</span><span class=p>,</span> <span class=c1>#登录手机号</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;password&#34;</span><span class=p>:</span> <span class=n>encryptPassword</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>password</span><span class=p>),</span> <span class=c1>#RSA加密后的登录密码</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ct&#34;</span><span class=p>:</span> <span class=s2>&#34;2&#34;</span><span class=p>,</span> <span class=c1>#固定参数</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;identify&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span> <span class=c1>#固定参数</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1># 配置登录数据</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;https://m.yiban.cn/api/v4/passport/login&#34;</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>params</span><span class=p>,</span> <span class=n>allow_redirects</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>cookies</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>COOKIES</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>HEADERS</span><span class=p>)</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>response</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>response</span><span class=p>[</span><span class=s2>&#34;response&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=mi>100</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>access_token</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>][</span><span class=s2>&#34;access_token&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>HEADERS</span><span class=p>[</span><span class=s2>&#34;Authorization&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;Bearer &#34;</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>access_token</span>
</span></span><span class=line><span class=cl>            <span class=c1># 增加cookie</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>COOKIES</span><span class=p>[</span><span class=s2>&#34;loginToken&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>access_token</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;用户信息:&#39;</span><span class=p>,</span><span class=n>response</span><span class=p>,</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;loginToken:&#39;</span><span class=p>,</span><span class=bp>self</span><span class=o>.</span><span class=n>access_token</span><span class=p>,</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;用户姓名:&#39;</span><span class=p>,</span><span class=n>response</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>][</span><span class=s2>&#34;user&#34;</span><span class=p>][</span><span class=s2>&#34;name&#34;</span><span class=p>],</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>手机号码：&#34;</span><span class=p>,</span><span class=n>response</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>][</span><span class=s2>&#34;user&#34;</span><span class=p>][</span><span class=s2>&#34;phone&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>mobile</span>
</span></span><span class=line><span class=cl>        <span class=c1>#返回https://f.yiban.cn/iapp/index?act=iapp7463所需的Cookie“loginToken=ce196e5fb2900bc35b44e1f1b4ed****”</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>#通过获取的loginToken访问iapp后台得到值verifyRequest</span>
</span></span><span class=line><span class=cl>        <span class=c1>#利用verifyRequest访问api获取签到用的cookie</span>
</span></span><span class=line><span class=cl>        <span class=c1>#返回cookie内容范例</span>
</span></span><span class=line><span class=cl>        <span class=c1>#{&#39;PHPSESSID&#39;: &#39;1aef34b976315dca8400711255f1a9af&#39;, &#39;cpi&#39;: &#39;eyJDaGFubmVsIjoieWliYW......TliNWViZTUxYWMifQ%3D%3D&#39;, &#39;is_certified&#39;: &#39;1&#39;}</span>
</span></span><span class=line><span class=cl>        <span class=c1>#PHPSESSID为关键值，有这一个参数就可以访问签到等相关内容</span>
</span></span><span class=line><span class=cl>        <span class=c1>#cpi 使用base64编码 有个人相关信息</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>auth</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span> <span class=c1># 获取签到cookie</span>
</span></span><span class=line><span class=cl>        <span class=n>iapp</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://f.yiban.cn/iapp/index?act=iapp7463&#34;</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>HEADERS</span><span class=p>,</span> <span class=n>allow_redirects</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>cookies</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>COOKIES</span><span class=p>)</span> <span class=c1># 利用 loginToken 访问获取 verifyRequest</span>
</span></span><span class=line><span class=cl>        <span class=n>act</span> <span class=o>=</span> <span class=n>iapp</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s2>&#34;Location&#34;</span><span class=p>]</span> <span class=c1># 返回302跳转目标</span>
</span></span><span class=line><span class=cl>        <span class=n>verifyRequest</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=sa>r</span><span class=s2>&#34;verify_request=(.*?)&amp;&#34;</span><span class=p>,</span> <span class=n>act</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span> <span class=c1># 正则取302跳转目标，得到 verify_request 数据</span>
</span></span><span class=line><span class=cl>        <span class=n>json</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;https://api.uyiban.com/base/c/auth/yiban?verifyRequest=&#34;</span> <span class=o>+</span> <span class=n>verifyRequest</span> <span class=o>+</span> <span class=s2>&#34;&amp;CSRF=&#34;</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>CSRF</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>HEADERS</span><span class=p>,</span> <span class=n>allow_redirects</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>cookies</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;csrf_token&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>CSRF</span><span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=c1>#访问api获取cookie CSRF值按此可用，只验证位数</span>
</span></span><span class=line><span class=cl>        <span class=n>cookies</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>utils</span><span class=o>.</span><span class=n>dict_from_cookiejar</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>cookies</span><span class=p>)</span> <span class=c1># 获取cookie</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>Attendancecookies</span> <span class=o>=</span> <span class=n>cookies</span> <span class=c1># 签到cookies赋值self.Attendancecookies</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Location:&#39;</span><span class=p>,</span><span class=n>act</span><span class=p>,</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;cookies:&#39;</span><span class=p>,</span><span class=bp>self</span><span class=o>.</span><span class=n>Attendancecookies</span><span class=p>,</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>authorization</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>testauth</span><span class=p>):</span> <span class=c1># 授权校本化</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>testauth</span> <span class=o>=</span> <span class=n>testauth</span>
</span></span><span class=line><span class=cl>        <span class=n>authhtml</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;https://oauth.yiban.cn/code/html?client_id=95626fa3080300ea&amp;redirect_uri=https://f.yiban.cn/iapp7463&#34;</span><span class=p>)</span> <span class=c1># 利用 loginToken 访问获取 verifyRequest</span>
</span></span><span class=line><span class=cl>        <span class=n>HTML_PUBLIC_KEY</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s1>&#39;&lt;input type=&#34;test&#34; id=&#34;key&#34; value=&#34;((?:.|</span><span class=se>\n</span><span class=s1>)+)?&#34; style=&#34;display:none&#34;&gt;&#39;</span><span class=p>,</span><span class=n>authhtml</span><span class=o>.</span><span class=n>text</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span> <span class=c1># 获取网页签到加密 password 证书</span>
</span></span><span class=line><span class=cl>        <span class=n>webcookies</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>utils</span><span class=o>.</span><span class=n>dict_from_cookiejar</span><span class=p>(</span><span class=n>authhtml</span><span class=o>.</span><span class=n>cookies</span><span class=p>)</span> <span class=c1># 获取校本化授权 cookie    登录需要</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;获取的网页cookie:&#34;</span><span class=p>,</span><span class=n>webcookies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;获取的网页加密证书:&#34;</span><span class=p>,</span><span class=n>HTML_PUBLIC_KEY</span><span class=p>,</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>HTML_cipher</span> <span class=o>=</span> <span class=n>PKCS1_v1_5</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>RSA</span><span class=o>.</span><span class=n>importKey</span><span class=p>(</span><span class=n>HTML_PUBLIC_KEY</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>HTML_cipher_text</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>HTML_cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=nb>bytes</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>password</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf8&#34;</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=n>HTML_cipher_decode</span> <span class=o>=</span> <span class=n>HTML_cipher_text</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;密码网页加密结果:&#34;</span><span class=p>,</span><span class=n>HTML_cipher_decode</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>webparams</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;oauth_uname&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>mobile</span> <span class=p>,</span> <span class=c1># 账号</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;oauth_upwd&#34;</span><span class=p>:</span> <span class=n>HTML_cipher_decode</span> <span class=p>,</span> <span class=c1># 加密后密码</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;client_id&#34;</span><span class=p>:</span> <span class=s2>&#34;95626fa3080300ea&#34;</span><span class=p>,</span> <span class=c1># 应用端编号</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;redirect_uri&#34;</span><span class=p>:</span> <span class=s2>&#34;http://f.yiban.cn/iapp7463&#34;</span><span class=p>,</span> <span class=c1># 应用端回调地址</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>webauth</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;https://oauth.yiban.cn/code/usersure&#34;</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>webparams</span><span class=p>,</span> <span class=n>cookies</span><span class=o>=</span><span class=n>webcookies</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>HEADERS</span><span class=p>)</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;授权结果&#34;</span><span class=p>,</span><span class=n>webauth</span><span class=p>,</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;授权成功，返回获取签到信息中...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>signPosition</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>Position</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;https://api.uyiban.com/nightAttendance/student/index/signPosition?CSRF=&#34;</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>CSRF</span><span class=p>,</span> <span class=n>allow_redirects</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>cookies</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;PHPSESSID&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>Attendancecookies</span><span class=p>[</span><span class=s1>&#39;PHPSESSID&#39;</span><span class=p>],</span> <span class=s1>&#39;csrf_token&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>CSRF</span><span class=p>},</span> <span class=n>headers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>HEADERS</span><span class=p>)</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>Position</span><span class=p>[</span><span class=s2>&#34;code&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span> <span class=c1># 判断是否登录成功</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;校本化已授权，有晚签任务</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;可签到数据:&#34;</span><span class=p>,</span><span class=n>Position</span><span class=p>,</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>State</span><span class=o>=</span><span class=n>Position</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>][</span><span class=s2>&#34;State&#34;</span><span class=p>]</span> <span class=c1># 获取状态码</span>
</span></span><span class=line><span class=cl>            <span class=n>Msg</span><span class=o>=</span><span class=n>Position</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>][</span><span class=s2>&#34;Msg&#34;</span><span class=p>]</span> <span class=c1># 获取返回信息</span>
</span></span><span class=line><span class=cl>            <span class=n>StartTime</span><span class=o>=</span><span class=n>Position</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>][</span><span class=s2>&#34;Range&#34;</span><span class=p>][</span><span class=s2>&#34;StartTime&#34;</span><span class=p>]</span> <span class=c1># 获取签到开始时间</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>StartTime</span> <span class=o>=</span>  <span class=n>StartTime</span>
</span></span><span class=line><span class=cl>            <span class=n>EndTime</span><span class=o>=</span><span class=n>Position</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>][</span><span class=s2>&#34;Range&#34;</span><span class=p>][</span><span class=s2>&#34;EndTime&#34;</span><span class=p>]</span> <span class=c1># 获取签到结束时间</span>
</span></span><span class=line><span class=cl>            <span class=n>pause</span> <span class=o>=</span> <span class=n>StartTime</span> <span class=o>-</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())</span> <span class=c1># 获取系统现在时间</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>State</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span> <span class=c1># 没有签到任务 如学校没有晚签</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;您&#34;</span><span class=p>,</span><span class=n>Position</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>][</span><span class=s2>&#34;Msg&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>State</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span> <span class=c1># 已签到</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] 签到接口返回数据：&#34;</span><span class=p>,</span><span class=n>Position</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>][</span><span class=s2>&#34;Msg&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>Address</span><span class=o>=</span><span class=n>jsonpath</span><span class=o>.</span><span class=n>jsonpath</span><span class=p>(</span><span class=n>Position</span><span class=p>,</span><span class=s1>&#39;$...Address&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span> <span class=c1># 获取可签到位置 地址</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>LngLat</span><span class=o>=</span><span class=n>jsonpath</span><span class=o>.</span><span class=n>jsonpath</span><span class=p>(</span><span class=n>Position</span><span class=p>,</span><span class=s1>&#39;$...LngLat&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span> <span class=c1># 获取可签到位置 经纬度</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>lonss</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>%.6f</span><span class=s1>&#39;</span> <span class=o>%</span><span class=nb>float</span><span class=p>(</span><span class=nb>round</span><span class=p>(</span><span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>LngLat</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;,&#34;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]),</span><span class=mi>3</span><span class=p>)</span> <span class=o>+</span> <span class=nb>float</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.000100</span><span class=p>,</span><span class=mf>0.000999</span><span class=p>)))</span> <span class=c1># 根据地址随机修改经度后3位，达到每次定位位置不一样</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>latss</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>%.6f</span><span class=s1>&#39;</span> <span class=o>%</span><span class=nb>float</span><span class=p>(</span><span class=nb>round</span><span class=p>(</span><span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>LngLat</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;,&#34;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]),</span><span class=mi>3</span><span class=p>)</span> <span class=o>+</span> <span class=nb>float</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.000100</span><span class=p>,</span><span class=mf>0.000999</span><span class=p>)))</span> <span class=c1># 根据地址随机修改纬度后3位，达到每次定位位置不一样</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>State</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span> <span class=c1># 已经到达签到时间</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;可以签到，立即执行！</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=bp>self</span><span class=o>.</span><span class=n>nightAttendance</span><span class=p>()</span> <span class=c1># 签到跳转</span>
</span></span><span class=line><span class=cl>                    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=n>State</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span> <span class=c1># 还未开始签到</span>
</span></span><span class=line><span class=cl>                            <span class=n>pause</span> <span class=o>=</span> <span class=n>StartTime</span> <span class=o>-</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())</span> <span class=c1># 获取剩余时间</span>
</span></span><span class=line><span class=cl>                            <span class=k>while</span> <span class=n>pause</span> <span class=o>&gt;=</span> <span class=mi>60</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>                                <span class=nb>list</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;</span><span class=se>\\</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;|&#34;</span><span class=p>,</span> <span class=s2>&#34;/&#34;</span><span class=p>,</span> <span class=s2>&#34;—&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                                <span class=n>index</span> <span class=o>=</span> <span class=n>pause</span> <span class=o>%</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>                                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] 距签到时间还有 </span><span class=si>{}</span><span class=s2> 秒 </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>pause</span><span class=p>,</span><span class=nb>list</span><span class=p>[</span><span class=n>index</span><span class=p>]),</span> <span class=n>end</span><span class=o>=</span><span class=s2>&#34;</span><span class=se>\r</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                <span class=n>pause</span> <span class=o>=</span> <span class=n>StartTime</span> <span class=o>-</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                                <span class=k>while</span> <span class=n>pause</span> <span class=o>&lt;=</span> <span class=mi>60</span> <span class=ow>and</span> <span class=n>pause</span> <span class=o>&gt;=</span><span class=mi>10</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>                                    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] 距签到时间还有 </span><span class=si>{}</span><span class=s2> 秒 </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>pause</span><span class=p>,</span><span class=nb>list</span><span class=p>[</span><span class=n>index</span><span class=p>]),</span> <span class=n>end</span><span class=o>=</span><span class=s2>&#34;</span><span class=se>\r</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                    <span class=n>pause</span> <span class=o>=</span> <span class=n>StartTime</span> <span class=o>-</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                                    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                                    <span class=k>while</span> <span class=n>pause</span> <span class=o>&lt;=</span> <span class=mi>10</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>                                        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] 距签到时间还有 </span><span class=si>{}</span><span class=s2> 秒 </span><span class=si>{}</span><span class=s2>&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>pause</span><span class=p>,</span><span class=nb>list</span><span class=p>[</span><span class=n>index</span><span class=p>],</span> <span class=n>end</span><span class=o>=</span><span class=s2>&#34;</span><span class=se>\r</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                        <span class=n>pause</span> <span class=o>=</span> <span class=n>StartTime</span> <span class=o>-</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                                        <span class=k>while</span> <span class=n>pause</span> <span class=o>&lt;=</span> <span class=mf>0.25</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>                                            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;到达签到时间！&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                            <span class=bp>self</span><span class=o>.</span><span class=n>nightAttendance</span><span class=p>()</span> <span class=c1># 签到跳转</span>
</span></span><span class=line><span class=cl>                                            <span class=k>return</span>
</span></span><span class=line><span class=cl>                                        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.25</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>Position</span><span class=p>[</span><span class=s2>&#34;code&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=mi>999</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] 晚签信息获取失败</span><span class=se>\n</span><span class=s2>[*] 有可能是校本化未授权或您的签到页面非本脚本所适配&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>authorization</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>nightAttendance</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span> <span class=c1># 执行签到</span>
</span></span><span class=line><span class=cl>        <span class=n>paramss</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Code&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;PhoneModel&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;SignInfo&#34;</span><span class=p>:</span> <span class=s1>&#39;{&#34;Reason&#34;:&#34;&#34;,&#34;AttachmentFileName&#34;:&#34;&#34;,&#34;LngLat&#34;:&#34;&#39;</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>lonss</span> <span class=o>+</span> <span class=s1>&#39;,&#39;</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>latss</span> <span class=o>+</span> <span class=s1>&#39;&#34;,&#34;Address&#34;:&#34;&#39;</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>Address</span> <span class=o>+</span> <span class=s1>&#39;&#34;}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;OutState&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>nightsign</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;https://api.uyiban.com/nightAttendance/student/index/signIn?CSRF=&#34;</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>Attendancecookies</span><span class=p>[</span><span class=s1>&#39;PHPSESSID&#39;</span><span class=p>],</span> <span class=n>data</span><span class=o>=</span><span class=n>paramss</span><span class=p>,</span> <span class=n>cookies</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;csrf_token&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>Attendancecookies</span><span class=p>[</span><span class=s1>&#39;PHPSESSID&#39;</span><span class=p>],</span> <span class=s1>&#39;PHPSESSID&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>Attendancecookies</span><span class=p>[</span><span class=s1>&#39;PHPSESSID&#39;</span><span class=p>]},</span> <span class=n>headers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>HEADERS</span><span class=p>)</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;签到返回数据:&#34;</span><span class=p>,</span><span class=n>nightsign</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1>#print(nightsign)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>signPosition</span><span class=p>()</span> <span class=c1># 跳转回signPosition验证是否签到成功</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>loginin</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span> <span class=c1># 登陆校验</span>
</span></span><span class=line><span class=cl>        <span class=c1># 应当先判断列表账号是否都能正常登陆</span>
</span></span><span class=line><span class=cl>        <span class=n>loginin</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>login</span><span class=p>()</span> <span class=c1># 登录</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>loginin</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;用户&#34;</span><span class=p>,</span><span class=n>loginin</span><span class=p>,</span><span class=s2>&#34;登陆失败，请处理&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;按任意键退出脚本&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>ord</span><span class=p>(</span><span class=n>msvcrt</span><span class=o>.</span><span class=n>getch</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>authorization</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=c1># 校本化授权先执行</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>setall</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span> <span class=c1># 多人签到</span>
</span></span><span class=line><span class=cl>        <span class=n>loginin</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>login</span><span class=p>()</span> <span class=c1># 登录</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>auth</span><span class=p>()</span> <span class=c1># 授权</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>signPosition</span><span class=p>()</span> <span class=c1># 判断能否签到&amp;自动跳转签到</span>
</span></span><span class=line><span class=cl>        <span class=c1>#self.authorization(0) # 校本化授权 已写入</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>save_accounts</span><span class=p>(</span><span class=n>accounts</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;accounts.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>account</span> <span class=ow>in</span> <span class=n>accounts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>account</span><span class=o>.</span><span class=n>mobile</span><span class=si>}</span><span class=s2>,</span><span class=si>{</span><span class=n>account</span><span class=o>.</span><span class=n>password</span><span class=si>}</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>load_accounts</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>accounts</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=s2>&#34;accounts.txt&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;accounts.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>mobile</span><span class=p>,</span> <span class=n>password</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>accounts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>yiban</span><span class=p>(</span><span class=n>mobile</span><span class=p>,</span> <span class=n>password</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>accounts</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>display_accounts</span><span class=p>(</span><span class=n>accounts</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;当前账户列表:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>account</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>accounts</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>idx</span><span class=si>}</span><span class=s2>. </span><span class=si>{</span><span class=n>account</span><span class=o>.</span><span class=n>mobile</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>accounts</span><span class=p>,</span> <span class=n>disturb_mode</span><span class=p>,</span> <span class=n>disturb_count</span> <span class=o>=</span> <span class=n>load_accounts</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>disturb_mode</span> <span class=o>==</span> <span class=s1>&#39;on&#39;</span> <span class=ow>and</span> <span class=n>disturb_count</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;免打扰模式开启，自动执行...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>disturb_count</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>action</span> <span class=o>=</span> <span class=s1>&#39;继续&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>action</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s1>&#39;继续&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>display_accounts</span><span class=p>(</span><span class=n>accounts</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>choice</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;要修改或增加账号吗？(修改/增加/执行): &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>choice</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s1>&#39;修改&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>index</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;请输入要修改的账号序号: &#34;</span><span class=p>))</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=mi>0</span> <span class=o>&lt;=</span> <span class=n>index</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>accounts</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=n>new_mobile</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;输入新的手机号: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>new_password</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;输入新的密码: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>accounts</span><span class=p>[</span><span class=n>index</span><span class=p>]</span> <span class=o>=</span> <span class=n>yiban</span><span class=p>(</span><span class=n>new_mobile</span><span class=p>,</span> <span class=n>new_password</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>save_accounts</span><span class=p>(</span><span class=n>accounts</span><span class=p>,</span> <span class=n>disturb_mode</span><span class=p>,</span> <span class=n>disturb_count</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;账户已更新&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>choice</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s1>&#39;增加&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>num_new_accounts</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;请输入要增加的账户数: &#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_new_accounts</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=n>mobile</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;请输入新手机号: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>password</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;请输入新密码: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>accounts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>yiban</span><span class=p>(</span><span class=n>mobile</span><span class=p>,</span> <span class=n>password</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>save_accounts</span><span class=p>(</span><span class=n>accounts</span><span class=p>,</span> <span class=n>disturb_mode</span><span class=p>,</span> <span class=n>disturb_count</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;新账户已添加&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>choice</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s1>&#39;执行&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>action</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;是否继续修改或增加账户？(继续/执行): &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>disturb_count</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>  <span class=c1># 当不在免打扰模式或免打扰次数用完时询问</span>
</span></span><span class=line><span class=cl>            <span class=n>disturb_mode</span> <span class=o>=</span> <span class=s1>&#39;on&#39;</span> <span class=k>if</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;是否开启免打扰模式？(是/否): &#34;</span><span class=p>)</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s1>&#39;是&#39;</span> <span class=k>else</span> <span class=s1>&#39;off&#39;</span>
</span></span><span class=line><span class=cl>            <span class=n>disturb_count</span> <span class=o>=</span> <span class=mi>7</span> <span class=k>if</span> <span class=n>disturb_mode</span> <span class=o>==</span> <span class=s1>&#39;on&#39;</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>save_accounts</span><span class=p>(</span><span class=n>accounts</span><span class=p>,</span> <span class=n>disturb_mode</span><span class=p>,</span> <span class=n>disturb_count</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>account</span> <span class=ow>in</span> <span class=n>accounts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>account</span><span class=o>.</span><span class=n>loginin</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;#签到检查通过#################</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>account</span> <span class=ow>in</span> <span class=n>accounts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>account</span><span class=o>.</span><span class=n>setall</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;##############################&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;签到任务已执行完成！&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><h1 id=一点点小改动>一点点小改动<a hidden class=anchor aria-hidden=true href=#一点点小改动>#</a></h1><p>这个脚本有几处在Arch Linux上并不适用。</p><p>pip会往系统里面带脏东西，所以并不能直接执行pip install。会有如下报错：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>pip install numpy
</span></span></span><span class=line><span class=cl><span class=go>error: externally-managed-environment
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>× This environment is externally managed
</span></span></span><span class=line><span class=cl><span class=go>╰─&gt; To install Python packages system-wide, try &#39;pacman -S
</span></span></span><span class=line><span class=cl><span class=go>    python-xyz&#39;, where xyz is the package you are trying to
</span></span></span><span class=line><span class=cl><span class=go>    install.
</span></span></span><span class=line><span class=cl><span class=go>    
</span></span></span><span class=line><span class=cl><span class=go>    If you wish to install a non-Arch-packaged Python package,
</span></span></span><span class=line><span class=cl><span class=go>    create a virtual environment using &#39;python -m venv path/to/venv&#39;.
</span></span></span><span class=line><span class=cl><span class=go>    Then use path/to/venv/bin/python and path/to/venv/bin/pip.
</span></span></span><span class=line><span class=cl><span class=go>    
</span></span></span><span class=line><span class=cl><span class=go>    If you wish to install a non-Arch packaged Python application,
</span></span></span><span class=line><span class=cl><span class=go>    it may be easiest to use &#39;pipx install xyz&#39;, which will manage a
</span></span></span><span class=line><span class=cl><span class=go>    virtual environment for you. Make sure you have python-pipx
</span></span></span><span class=line><span class=cl><span class=go>    installed via pacman.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>note: If you believe this is a mistake, please contact your Python installation or OS distribution provider. You can override this, at the risk of breaking your Python installation or OS, by passing --break-system-packages.
</span></span></span><span class=line><span class=cl><span class=go>hint: See PEP 668 for the detailed specification.
</span></span></span></code></pre></div><p>最恰当的方法应该是给他来个虚拟环境。且msvcrt是一个Windows特定的模块，在Linux上不可用，可以代码里面直接给它扬了：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>...</span><span class=c1># 上述代码照抄</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>loginin</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span> <span class=c1># 登陆校验</span>
</span></span><span class=line><span class=cl>    <span class=c1># 应当先判断列表账号是否都能正常登陆</span>
</span></span><span class=line><span class=cl>    <span class=n>loginin</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>login</span><span class=p>()</span> <span class=c1># 登录</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>loginin</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;用户&#34;</span><span class=p>,</span><span class=n>loginin</span><span class=p>,</span><span class=s2>&#34;登陆失败，请处理&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;按任意键退出脚本&#34;</span><span class=p>)</span><span class=c1># 移除了msvcrt.getch()，因为在Linux上不可用</span>
</span></span><span class=line><span class=cl>        <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;按回车键退出脚本&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>authorization</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=c1># 校本化授权先执行</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=o>...</span><span class=c1># 下面照抄</span>
</span></span></code></pre></div><p>构建虚拟环境需要：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>python3 -m venv /path/to/new/virtual/environment
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>source /path/to/new/virtual/environment/bin/activate
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>pip install requests numpy jsonpath
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>deactivate
</span></span></span></code></pre></div><p>在你的py文件目录下创建一个.sh：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span>!/bin/bash
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>VENV_DIR=&#34;/path/to/your/venv&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SCRIPT_PATH=&#34;/path/to/your/script.py&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>source &#34;$VENV_DIR/bin/activate&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>python &#34;$SCRIPT_PATH&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>deactivate
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>chmod +x /path/to/your/script.sh
</span></span></span><span class=line><span class=cl><span class=go>/path/to/your/script.sh
</span></span></span></code></pre></div><p>然后就是考虑在Linux上如何进行定时任务的问题，经某位lockey朋友启发选择直接上大家所熟悉的cron：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>sudo pacman -S cronie
</span></span></span><span class=line><span class=cl><span class=go>sudo systemctl start cronie.service
</span></span></span><span class=line><span class=cl><span class=go>sudo systemctl enable cronie.service
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>crontab -e # 转入nano编辑
</span></span></span><span class=line><span class=cl><span class=go>0 0 * * * /path/to/your/script.sh # 自行照格式修改
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span>ctrl+o写入，enter，ctrl+x退出
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>crontab -l # 检查一下有没有写好
</span></span></span></code></pre></div><p><strong>DONE.</strong></p></div><footer class=post-footer><ul class=post-tags></ul></footer><script src=https://giscus.app/client.js data-repo=nanimonaic/docx data-repo-id=R_kgDOKiAoMQ data-category-id=DIC_kwDOKiAoMc4CaPcT data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>nanimonai's Blog</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>